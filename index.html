<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Somnath Kurmi – Vedic Kundali & Matching</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="logo.png">

<style>
body{font-family:Segoe UI;background:#fff7e6;margin:0;color:#4b2e05}
header{background:linear-gradient(135deg,#ffb300,#ff6f00);color:white;text-align:center;padding:30px}
header img{width:120px}
section{max-width:1100px;margin:auto;padding:30px}
.box{background:white;padding:25px;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,0.1);margin-bottom:30px}
input,select,button{width:100%;padding:12px;margin-top:10px;border-radius:6px;border:1px solid #ccc}
button{background:#ff9800;color:white;font-size:18px;border:none;cursor:pointer}
button:hover{background:#e68900}
.suggest{background:white;border:1px solid #ccc;max-height:150px;overflow:auto;position:absolute;z-index:10}
.suggest div{padding:8px;cursor:pointer}
.suggest div:hover{background:#ffe0b2}
.field{position:relative}
</style>
</head>

<body>

<header>
<img src="logo.png">
<h1>Somnath Kurmi’s Classical Vedic Jyotish</h1>
<p>Kundali • Matching • Shastra-Verified</p>
</header>

<section>

<!-- ================= SINGLE KUNDALI ================= -->
<div class="box">
<h2>Generate Your Kundali</h2>

<input id="name" placeholder="Full Name">
<select id="sex">
  <option value="">Gender</option>
  <option>Male</option>
  <option>Female</option>
</select>

<input id="dob" type="date">
<input id="tob" type="time">

<label><b>Where was this birth time written?</b></label>
<select id="tzmode">
  <option value="">Select one</option>
  <option value="india">Born in India (Indian Time)</option>
  <option value="nri">Born outside India (Foreign Time)</option>
</select>

<div class="field">
<input id="place" placeholder="Place of Birth" oninput="suggestPlace(this,'sp')">
<div id="sp" class="suggest"></div>
</div>

<button onclick="singleKundali()">Generate Kundali</button>
</div>


<!-- ================= KUNDALI MATCHING ================= -->
<div class="box">
<h2>Kundali Matching</h2>

<h3>Boy</h3>
<input id="bname" placeholder="Boy Name">
<input id="bdob" type="date">
<input id="btob" type="time">

<select id="btz">
  <option value="">Where was his birth time written?</option>
  <option value="india">Born in India</option>
  <option value="nri">Born outside India</option>
</select>

<div class="field">
<input id="bplace" placeholder="Boy Place" oninput="suggestPlace(this,'bp')">
<div id="bp" class="suggest"></div>
</div>

<h3>Girl</h3>
<input id="gname" placeholder="Girl Name">
<input id="gdob" type="date">
<input id="gtob" type="time">

<select id="gtz">
  <option value="">Where was her birth time written?</option>
  <option value="india">Born in India</option>
  <option value="nri">Born outside India</option>
</select>

<div class="field">
<input id="gplace" placeholder="Girl Place" oninput="suggestPlace(this,'gp')">
<div id="gp" class="suggest"></div>
</div>

<button onclick="matchKundali()">Match Kundali</button>
</div>

</section>

<script>
let places={};

// ---------- Place search ----------
async function suggestPlace(input,id){
 if(input.value.length<3) return;
 const r=await fetch("https://nominatim.openstreetmap.org/search?format=json&limit=5&q="+input.value);
 const d=await r.json();
 const box=document.getElementById(id);
 box.innerHTML="";
 d.forEach(p=>{
  const div=document.createElement("div");
  div.innerText=p.display_name;
  div.onclick=()=>{
    input.value=p.display_name;
    places[input.id]={lat:parseFloat(p.lat),lon:parseFloat(p.lon)};
    box.innerHTML="";
  };
  box.appendChild(div);
 });
}

// ---------- Time conversion ----------
function getUTC(dob,tob,mode){
 const [y,m,d]=dob.split("-");
 const [hh,mm]=tob.split(":");
 let dt=new Date(y,m-1,d,hh,mm);

 if(mode==="india"){
   dt.setHours(dt.getHours()-5);
   dt.setMinutes(dt.getMinutes()-30);
 }
 else if(mode==="nri"){
   dt=new Date(dt.toISOString());
 }
 else{
   alert("Please select where birth time was written");
   throw "";
 }

 return {
   date:dt.toISOString().slice(0,10),
   time:dt.toISOString().slice(11,16)
 };
}

// ---------- Single Kundali ----------
async function singleKundali(){
 const name=nameEl.value;
 const sex=sexEl.value;
 const dob=dobEl.value;
 const tob=tobEl.value;
 const tz=tzmode.value;
 const place=placeEl.value;
 const g=places["place"];

 if(!name||!sex||!dob||!tob||!tz||!g){alert("Fill all details");return;}

 const utc=getUTC(dob,tob,tz);

 const api=await fetch(`https://kundali-engine.onrender.com/kundali?dob=${utc.date}&tob=${utc.time}&lat=${g.lat}&lon=${g.lon}`);
 const d=await api.json();

 let txt=`Name:${name}\nGender:${sex}\nDOB:${dob}\nTime:${tob}\nPlace:${place}\n\n`;
 for(let p in d.planets){
   txt+=`${p}: ${d.planets[p].rashi} ${d.planets[p].nakshatra}\n`;
 }

 window.open("https://chatgpt.com/g/g-6964d5788f108191886888ded114bdf3-classical-vedic-jyotish-ai?prompt="+encodeURIComponent(txt),"_blank");
}

// ---------- Matching ----------
async function matchKundali(){
 const b=places["bplace"], g=places["gplace"];
 if(!b||!g||!bdob.value||!btob.value||!gdob.value||!gtob.value||!btz.value||!gtz.value){
   alert("Fill all matching details");return;
 }

 const bu=getUTC(bdob.value,btob.value,btz.value);
 const gu=getUTC(gdob.value,gtob.value,gtz.value);

 const api=await fetch(`https://kundali-engine.onrender.com/match?b_dob=${bu.date}&b_tob=${bu.time}&b_lat=${b.lat}&b_lon=${b.lon}&g_dob=${gu.date}&g_tob=${gu.time}&g_lat=${g.lat}&g_lon=${g.lon}`);
 const d=await api.json();

 let txt=`Boy Moon:${d.boy.Moon.nakshatra}\nGirl Moon:${d.girl.Moon.nakshatra}\nGuna:${d.guna_score}\nResult:${d.result}`;

 window.open("https://chatgpt.com/g/g-6964d5788f108191886888ded114bdf3-classical-vedic-jyotish-ai?prompt="+encodeURIComponent(txt),"_blank");
}
</script>

</body>
</html>
