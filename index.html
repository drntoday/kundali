<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Somnath Kurmi – Vedic Kundali & Matching</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="logo.png">

<style>
body{font-family:Segoe UI;background:#fff7e6;margin:0;color:#4b2e05}
header{background:linear-gradient(135deg,#ffb300,#ff6f00);color:white;text-align:center;padding:30px}
header img{width:120px}
section{max-width:1100px;margin:auto;padding:30px}
.box{background:white;padding:25px;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,0.1);margin-bottom:30px}
input,select,button{width:100%;padding:12px;margin-top:10px;border-radius:6px;border:1px solid #ccc}
button{background:#ff9800;color:white;font-size:18px;border:none;cursor:pointer}
button:hover{background:#e68900}
.suggest{background:white;border:1px solid #ccc;max-height:150px;overflow:auto;position:absolute;z-index:10}
.suggest div{padding:8px;cursor:pointer}
.suggest div:hover{background:#ffe0b2}
.field{position:relative}
</style>
</head>

<body>

<header>
<img src="logo.png">
<h1>Somnath Kurmi’s Classical Vedic Jyotish</h1>
<p>Kundali • Matching • Shastra-Verified</p>
</header>

<section>

<div class="box">
<h2>Generate Your Kundali</h2>
<input id="name" placeholder="Full Name">
<select id="sex">
<option value="">Gender</option><option>Male</option><option>Female</option>
</select>
<input id="dob" type="date">
<input id="tob" type="time">
<div class="field">
<input id="place" placeholder="Place of Birth" oninput="suggestPlace(this,'sp')">
<div id="sp" class="suggest"></div>
</div>
<button onclick="singleKundali()">Generate Kundali</button>
</div>

<div class="box">
<h2>Kundali Matching</h2>

<h3>Boy</h3>
<input id="bname" placeholder="Boy Name">
<input id="bdob" type="date">
<input id="btob" type="time">
<div class="field">
<input id="bplace" placeholder="Boy Place" oninput="suggestPlace(this,'bp')">
<div id="bp" class="suggest"></div>
</div>

<h3>Girl</h3>
<input id="gname" placeholder="Girl Name">
<input id="gdob" type="date">
<input id="gtob" type="time">
<div class="field">
<input id="gplace" placeholder="Girl Place" oninput="suggestPlace(this,'gp')">
<div id="gp" class="suggest"></div>
</div>

<button onclick="matchKundali()">Match Kundali</button>
</div>

</section>

<script>
let places={};

async function suggestPlace(input,id){
 if(input.value.length<3) return;
 const r=await fetch("https://nominatim.openstreetmap.org/search?format=json&limit=5&q="+input.value);
 const d=await r.json();
 const box=document.getElementById(id);
 box.innerHTML="";
 d.forEach(p=>{
  const div=document.createElement("div");
  div.innerText=p.display_name;
  div.onclick=()=>{
    input.value=p.display_name;
    places[input.id]={lat:parseFloat(p.lat),lon:parseFloat(p.lon)};
    box.innerHTML="";
  }
  box.appendChild(div);
 });
}

function fmt(x){ return Number(x).toFixed(5); }

async function getUTC(dob, tob, lat, lon){
  const [y,m,d] = dob.split("-");
  const [hh,mm] = tob.split(":");

  const tz = await fetch(`https://secure.geonames.org/timezoneJSON?lat=${lat}&lng=${lon}&username=drn.today`);
  const tzdata = await tz.json();

  const offset = tzdata.gmtOffset; // includes DST

  let local = new Date(y, m-1, d, hh, mm);
  local.setHours(local.getHours() - offset);

  return {
    date: local.toISOString().slice(0,10),
    time: local.toISOString().slice(11,16),
    offset: offset,
    timezone: tzdata.timezoneId
  };
}

async function singleKundali(){
 const name=document.getElementById("name").value;
 const sex=document.getElementById("sex").value;
 const dob=document.getElementById("dob").value;
 const tob=document.getElementById("tob").value;
 const place=document.getElementById("place").value;
 const g=places["place"];

 if(!name||!sex||!dob||!tob||!g){ alert("Fill all details"); return; }

 const utc = await getUTC(dob, tob, g.lat, g.lon);

 const api=await fetch(`https://kundali-engine.onrender.com/kundali?dob=${utc.date}&tob=${utc.time}&lat=${g.lat}&lon=${g.lon}`);
 const d=await api.json();

 let txt = 
`ASTRONOMICAL KUNDALI
Ephemeris: Swiss Ephemeris
Ayanamsha: Lahiri

Birth:
Name: ${name}
Gender: ${sex}
Local DOB: ${dob}
Local Time: ${tob}
Timezone: ${utc.timezone} (UTC ${utc.offset})
UTC DOB: ${utc.date}
UTC Time: ${utc.time}
Place: ${place}
Latitude: ${g.lat}
Longitude: ${g.lon}

Astronomy:
Julian Day: ${fmt(d.astronomy.jd)}
Julian Ephemeris Day: ${fmt(d.astronomy.jde)}
Delta-T: ${fmt(d.astronomy.delta_t)}
Sidereal Time: ${fmt(d.astronomy.sidereal_time)}
Ayanamsha: ${fmt(d.astronomy.ayanamsha)}

Lagna:
Degree: ${fmt(d.lagna.degree)}°
Rashi: ${d.lagna.rashi}
Nakshatra: ${d.lagna.nakshatra}
Pada: ${d.lagna.pada}

Moon Seed (Vimshottari):
Nakshatra Index: ${d.moon_seed.nakshatra_index}
Balance Fraction: ${fmt(d.moon_seed.balance_fraction)}

PLANETS
`;

 for(let p in d.planets){
   const P=d.planets[p];
   txt += `
${p}:
 Degree: ${fmt(P.degree)}°
 Rashi: ${P.rashi}
 Nakshatra: ${P.nakshatra}
 Pada: ${P.pada}
 Speed: ${fmt(P.speed)}
 Retrograde: ${P.retrograde}
`;
 }

 window.open("https://chatgpt.com/g/g-6964d5788f108191886888ded114bdf3-classical-vedic-jyotish-ai?prompt="+encodeURIComponent(txt),"_blank");
}
</script>

</body>
</html>
